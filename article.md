# CBITS: Интегрированная торговая система Crypto BERT

## Аннотация

Большинство подходов к торговле на основе текстового анализа в криптовалютной сфере используют лексические, основанные
на правилах методы для извлечения новостных сентиментов. Однако языковые модели (LM), предназначенные для общего
назначения, не всегда подходят для криптовалютной области из-за жаргона, который отсутствует в общих текстах.

Это исследование отвечает на вопрос: «Возможно ли, что языковые модели могут приносить прибыль, эффективно применяя
оценку сентимента задачи обработки естественного языка совместно с графиковыми показателями в системе торговли BTC?» Мы
сосредотачиваем внимание на эффективности обеих оценок, которые существенно влияют на прибыль торговой системы.

Мы представляем CBITS: Интегрированную торговую систему на основе Crypto BERT, построенную на предварительно обученных
языковых моделях для анализа сентимента криптовалют на корейском языке в поддержку торговых моделей Биткойна (BTC). Мы
предварительно обучили специализированные для криптовалют языковые модели на архитектуре трансформеров-энкодеров. Вместе
с нашими предварительно обученными моделями мы также представляем собственный датасет для дообучения, использованный для
тренировки моделей по классификации сентимента BTC, и показываем, что использование сентиментных оценок наряду с
графиковыми данными BTC улучшает эффективность торговых моделей BTC и позволяет создать рыночно-нейтральную торговую
стратегию.

## I. Введение

С момента появления рынка криптовалют, который к 2022 году стал рынком с капитализацией в триллион долларов, Биткойн (
BTC) привлёк внимание исследовательского сообщества благодаря своим нестандартным колебаниям цен и непредсказуемости. В
попытке предсказать поведение цен BTC было опубликовано множество работ. Хорошо известно в области финансов, что
новостной сентимент помогает прогнозировать колебания цен финансовых активов [13, 25].

Чтобы эффективно извлекать важные торговые сигналы из новостных статей в автоматическом режиме, возникает закономерный
вопрос: «Почему до сих пор не существует публично доступных языковых моделей (LM), ориентированных на криптовалюты и
блокчейн?»

С момента появления BTC [27] крипторынок быстро развивался, и многие финансовые инвесторы стремились получить
преимущество, используя как статистические методы [16], так и методы машинного обучения [4]. Особенно начали появляться
подходы, основанные на текстовом анализе [1, 29], для прогнозирования цен на криптовалюту.

В отличие от финансовой сферы, где уже существуют предварительно обученные языковые модели, адаптированные к предметной
области, в криптовалютной сфере текстовый анализ в основном реализуется с помощью лексических и основанных на правилах
методов. Вдохновившись успехом FinBERT [2] в финансовом текстовом анализе, мы предлагаем CBITS: Интегрированную торговую
систему на основе Crypto BERT, построенную на предварительно обученных языковых моделях, применимых к крипто- и
блокчейн-домену на корейском языке.

В данном исследовании мы сосредоточены на вычислении сентиментных оценок крипто-новостей и использовании этих оценок для
повышения эффективности нашей торговой модели BTC.

Корейский язык, обладая агглютинативной морфологией, представляет собой трудность для обработки, поскольку занимает
промежуточное положение между изолирующими и флективными языками [18].
В корейском языке единицей разделения текста является эоджол (eojeol), который состоит из более чем одного морфемного
элемента. Первая трудность заключается в том, что значение эоджола может меняться в зависимости от грамматической
морфемы. Например, значение существительного «그 (он)» изменяется в зависимости от присоединённой грамматической морфемы,
как в «그는 (он есть)» или «그에게 (ему)».

Вторая трудность заключается в том, что слог, состоящий из согласной и гласной, может быть представлен по-разному в
зависимости от значения морфемы. Например, «새 (птица)», состоящий из «ㅅ» и «ㅐ», может быть преобразован в «소», что
означает «корова», при изменении гласной.

По этим причинам языковая модель, адаптированная к конкретной предметной области, должна проектироваться иначе, чем
универсальные языковые модели. Мы разработали предварительно обученную модель с использованием SentencePiece [19],
алгоритма токенизации на основе подслов, не зависящего от конкретного языка и не требующего специфической языковой
обработки.

Мы собрали различные датасеты на тему корейской криптовалютной лексики, чтобы предварительно обучить три модели на базе
трансформеров: BERT [11], RoBERTa [24] и DeBERTa [14]. Также мы создали собственный датасет для дообучения, чтобы
обучить наши модели выполнять задачу классификации сентимента BTC. Корпус для дообучения был разработан таким образом,
чтобы CBITS мог обучиться тому, как новостная статья может повлиять на цену BTC.

Задача классификации сентимента заключается не просто в определении полярности новостей, но в том, чтобы понять, как они
могут повлиять на движение цен BTC. На **Рисунке 1** представлена схема CBITS с оценками как сентимента, так и графика в
торговой системе BTC.

Мы разработали торговую модель для бессрочного деривативного рынка BTC Tether (USDT), основываясь на классификационном
подходе, описанном в [36], и дополнили торгового бота признаками новостного сентимента, полученными из наших дообученных
языковых моделей. Мы показали, что оценки сентимента новостей, полученные из предварительно обученных криптовалютных
моделей, улучшают производительность торгового бота.

Также мы показали, что TabNet [3] является оптимальным выбором для торговой модели BTC, экспериментально подтвердив, что
она демонстрирует наилучшие и наиболее устойчивые результаты среди всех протестированных нами моделей.

Наши торговые модели были специально разработаны для торговли на рынке деривативов, так как мы стремились создать
рыночно-нейтральную стратегию (то есть модель может приносить прибыль как на растущем, так и на падающем рынке).

Основные вклад в исследование можно сформулировать следующим образом:

1. Мы предлагаем новый датасет новостей о криптовалютах на корейском языке, специально адаптированный для BTC. Каждая
   новость помечается как положительная, отрицательная или нейтральная в зависимости от её влияния на движение цены BTC.

2. Мы разрабатываем предварительно обученные языковые модели, адаптированные к криптовалютному домену на корейском
   языке, и дообучаем их на нашем датасете.

3. Мы предлагаем торговые модели на основе классификации для торговли BTC на рынке деривативов (BTC/USDT Perpetual).

4. Мы доказываем эффективность CBITS в повышении производительности наших торговых моделей BTC.

## II. Связанные исследования

Предыдущие исследования внедряли подходы глубокого обучения для текстового анализа, и одним из заметных примеров
является усиленное обучение (reinforcement learning, RL) с расширением состояния в финансовой сфере [26, 35]. Расширение
состояния достигается путём включения новостного сентимента в RL-фреймворк, обучая иерархическую сеть внимания (
hierarchical attention network) [34] с использованием трёх различных техник векторизации слов. Было доказано, что такая
архитектура превосходит как стратегию "купи и держи", так и другие методы онлайн-отбора портфеля [22].

Недавно Мохан и соавт. [26] предсказывали цены акций, используя сеть LSTM [15], на вход которой подавались данные о
ценах акций и сентименты заголовков новостей, полученные с помощью дообученной модели FinBERT. Они показали, что
использование текстовой информации значительно улучшает эффективность внутридневных торговых моделей.

Также были исследования, использующие другие подходы к внедрению признаков сентимента, такие как работа Сонкия и
соавт. [30], в которой сентименты новостей, извлечённые с помощью BERT, передаются в генеративно-состязательные сети (
GAN) [12], а также исследование Чен и соавт. [7], в котором используются контекстуализированные эмбеддинги, полученные
из заголовков новостей, для прогнозирования цен.

Хотя в ряде последних исследований применялись более сложные архитектуры глубокого обучения для классификации полярности
криптовалютных текстов [29, 32], ни одно из них не использует предварительно обученные языковые модели, адаптированные
под криптодомен.

## III. Процесс аннотирования данных

Для повышения качества аннотаций мы проводили процесс аннотирования с привлечением экспертов в области криптовалют.

### A. Сбор корпуса криптовалютных новостей

Для дообучения языковых моделей в рамках CBITS мы собрали данные с одного из ведущих корейских сайтов криптовалютных
новостей — Coinness Korea (CK)¹ — за период с 2018-01-19 14:00 UTC по 2022-04-16 00:00 UTC. Coinness Korea круглосуточно
предоставляет информацию о криптовалютах и блокчейне, помогая участникам рынка принимать более взвешенные инвестиционные
решения.

---

¹ Coinness Korea (CK) — https://kr.coinness.com/

#### 1) Процесс аннотирования

Датасет был размечен профессиональным дневным трейдером и дополнительно проверен другим трейдером для перекрёстной
верификации. Во время аннотирования разметчикам предоставлялись результаты классификации сентимента, полученные с
помощью FinBERT, а также данные о «бычьих/медвежьих» голосованиях с сайта CK в качестве справочной информации.

Кроме того, новости не анализировались изолированно: аннотаторам предписывалось учитывать как графики движения цен, так
и новостной контент при принятии решений о метках. При этом они следовали заранее подготовленным инструкциям по
аннотированию, подробности которых изложены в разделе III-A2.

#### 2) Руководство по аннотированию

- Поскольку наш торговый бот будет осуществлять торговлю BTC на рынке деривативов, сентимент новостей размечается в
  зависимости от того, как конкретная новость может повлиять на цену BTC. Если новость касается криптовалюты, которая
  никак не влияет на BTC, даже если её общий сентимент положительный или отрицательный — такая новость получает
  нейтральную метку. Иными словами, сентимент определяется относительно BTC.

- Новости о росте цен, «бычьем» настроении и притоке инвестиций в крупные криптовалюты (входящие в топ-15 по рыночной
  капитализации) также считаются благоприятными для BTC и получают положительную метку. Однако, если в это же время
  резко падает доминирование BTC, метка становится отрицательной.

- Новости о крупных переводах BTC на биржи получают отрицательную метку, так как это обычно сигнализирует о намерении
  продать или открыть короткие позиции. Если объём депозита небольшой или связан с поступлением стейблкоинов, то метка
  нейтральная.

- Перевод криптовалют с крупных бирж (например, Binance, Bybit) на анонимные кошельки или между анонимными кошельками
  размечается как нейтральный.

- Большинство провокационных твитов Илона Маска размечаются как положительные, поскольку он никогда не способствовал
  снижению цен. Тем не менее, считается, что его влияние на рынок со временем ослабевает.

- Мнения других инфлюенсеров или публичных фигур размечаются как нейтральные. Однако заявления представителей Сената США
  или ФРС считаются значимыми и получают положительную или отрицательную метку.

- Новости о том, что компания или страна использует или инвестирует в криптовалюту, обычно получают положительную метку.
  Если же компания неизвестна или малозначима — метка нейтральная.

- Все срочные новости, в которых упоминается количество упоминаний или твитов о BTC, тщательно анализируются совместно с
  графиками и получают положительную или отрицательную метку. Многочисленные упоминания конкретной криптовалюты в
  Twitter, как правило, свидетельствуют о значительных ценовых колебаниях.

- Рост индекса цен, рост цен на нефть, золото и государственные облигации — основные причины снижения NASDAQ. Поскольку
  BTC и NASDAQ часто движутся синхронно, такие новости получают отрицательную метку.

- Новости о небольших инвестициях получают нейтральную метку, в то время как привлечение крупных фондов и
  институциональных инвестиций — положительную.

- Любые небольшие инвестиции в крупные монеты (из топ-15 по капитализации) получают нейтральную метку.

- Новости о высоких доходах или объемах торговли NFT или метавселенными платформами получают положительную метку.

- Любое указание на снижение доминирования BTC получает отрицательную метку.

- Новости о внедрении или использовании BTC в какой-либо стране мира, как правило, размечаются положительно.

- Снижение хешрейта BTC считается отрицательным фактором, тогда как его рост — положительным.

- Новости о крахе экономики какой-либо страны считаются негативными.

- Разблокировка замороженных крупных криптовалют в целом считается нейтральной.

- Сжигание токенов криптовалют с высокой рыночной капитализацией, как правило, считается положительным событием.

### B. Серебряный датасет (Silver Dataset)

Аннотированный золотой датасет представлен на **Рисунке 2**. Метка 0 соответствует положительным новостям, метка 1 —
отрицательным, а метка 2 — нейтральным. Приблизительно 77% меток являются нейтральными, 15% — положительными и 8% —
отрицательными.

Из-за сильного дисбаланса в распределении сентиментных меток в аннотированном золотом датасете мы использовали лучшую
дообученную языковую модель, описанную в разделе V-B, для извлечения только положительных и отрицательных новостей из
неразмеченного новостного корпуса за период с 2018-01-19 по 2022-04-16.

CBITS размечает 18 005 новостей как положительные или отрицательные. Этот серебряный датасет также прошёл перекрёстную
проверку со стороны аннотаторов. После отбора достоверно положительных и отрицательных примеров из серебряного датасета,
они были объединены с золотым датасетом для проведения статистических тестов, описанных в разделе IV-A.

### C. Данные графиков (Chart Data)

Мы собрали торговые данные по паре BTC/USDT с интервалом в 4 часа с биржи Binance², одной из крупнейших криптовалютных
бирж. После сбора и инженерии признаков из графиков мы получили данные за период с 2017-08-23 16:00 UTC по 2022-04-23
00:00 UTC.

В общей сложности мы использовали 35 признаков, связанных с графиками, не включая целевую переменную. Разделение данных
на обучающую, валидационную и тестовую выборки выполнено следующим образом:

- Обучающая выборка: с 2017-08-23 16:00 UTC по 2022-01-27 16:00 UTC
- Валидационная выборка: с 2022-01-28 00:00 UTC по 2022-02-13 20:00 UTC
- Тестовая выборка: с 2022-02-14 00:00 UTC по 2022-04-23 00:00 UTC

Выборки не пересекаются по времени, что исключает эффект заглядывания в будущее (look-ahead bias).

---

² Binance — https://www.binance.com

### D. Признаки графиков, используемые в торговых моделях BTC

В этом разделе мы подробно описываем признаки, извлечённые из графиков. Вместо использования «сырых» графиковых данных (
например, high, low, open, close, volume), мы применили методы инженерии признаков для получения более полезной
информации для торговли.

Инжиниринг признаков в контексте графиков может быть очень обширным, поскольку существует сотни технических индикаторов.
Однако, поскольку объём доступных графиковых данных относительно невелик, добавление слишком большого количества
признаков может ухудшить производительность модели. Поэтому мы выбрали лишь ограниченный набор технических индикаторов и
признаков.

Большинство этих признаков связано с волатильностью и моментумом (momentum), так как основное внимание уделяется
фиксации изменений в покупательской или продажной активности. Это особенно важно для прогнозирования краткосрочных
движений рынка.

#### Описание используемых признаков:

- **Дифференцирование (Differencing):**  
  Это простое вычисление отношения «сырых» графиковых признаков между различными временными периодами. Поскольку мы
  используем графиковые данные с интервалом в 4 часа, разница между двумя последовательными периодами (например, t и t −
  1) будет соответствовать этим 4 часам.

  Первая разность цен закрытия рассчитывается следующим образом:

        (Close) = Closeₜ / Closeₜ₋₁

  В общем случае, K-я разность цен закрытия определяется как:

        K-я разность (Close) = Closeₜ / Closeₜ₋ₖ

Мы применяли процедуру дифференцирования ко всем следующим признакам: open, high, low, close и volume, используя
значения K = 1, 2, 3, 4, 5.

- **EBSW (Even Better Sine Wave):**  
  EBSW — это модификация синусоиды Гилберта (Hilbert sine wave), и данный индикатор предоставляет модели информацию о
  текущих «бычьих» и «медвежьих» циклах цен. Как правило:

- Значение EBSW > 0.85 указывает на перекупленность актива;
- Значение EBSW < -0.85 указывает на перепроданность актива.

Для вычисления EBSW мы использовали библиотеку `pandas-ta`³.

---

³ pandas-ta — https://github.com/twopirllc/pandas-ta

- **Chaikin Money Flow (CMF):**  
  Индикатор Chaikin Money Flow используется для отслеживания как накопления, так и распределения актива за определённый
  период времени. Значения CMF находятся в диапазоне от -1 до +1. Пересечения отметки 0 (вверх или вниз) могут
  использоваться для выявления моментов активности в покупках или продажах.

  Для вычисления CMF использовалась библиотека `pandas-ta`. Применялся стандартный период 20.

- **VWAP/Open:**  
  Отношение объёмно-взвешенной средней цены (VWAP) к цене открытия. Расчёт VWAP начинается с вычисления типичной цены (
  TP), которая представляет собой среднее значение между минимумом, максимумом и ценой закрытия:

      TP = (Low + High + Close) / 3

  VWAP на момент времени *t* рассчитывается по следующей формуле:

      VWAPₜ = (Σ (TPᵢ × Volumeᵢ)) / (Σ Volumeᵢ), где i = 1 до t

- **Другие соотношения (Other ratio features):**  
  Использовались различные соотношения между исходными графиковыми признаками, такие как:
- High / Low
- High / Open
- Close / Open
- Low / Open

Эти признаки дают модели информацию о волатильности цен.

- **Временная информация (Time Information):**  
  Мы также использовали временные признаки: часы, дни и месяцы. Информация о годах (например, 2020, 2021, 2022) была сознательно исключена, поскольку годы не подчиняются циклическому характеру, в отличие от часов, дней и месяцев.

## IV. Методология

В разделе IV-A мы описываем сильную корреляцию между новостным сентиментом и доходностью BTC. Основываясь на этом наблюдении, в разделе IV-B мы представляем подход к торговой модели BTC, основанный на задаче классификации.
